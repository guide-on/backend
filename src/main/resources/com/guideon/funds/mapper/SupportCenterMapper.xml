<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.guideon.funds.mapper.SupportCenterMapper">

    <!-- Result Map 정의 -->
    <resultMap id="SupportCenterResultMap" type="com.guideon.funds.domain.SupportCenter">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="jurisdiction" column="jurisdiction"/>
        <result property="address" column="address"/>
        <result property="phone" column="phone"/>
        <result property="fax" column="fax"/>
        <result property="lat" column="lat"/>
        <result property="lng" column="lng"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <!-- 공통 컬럼 정의 -->
    <sql id="selectColumns">
        id, name, jurisdiction, address, phone, fax, lat, lng, created_at, updated_at
    </sql>

    <!-- 전체 지원센터 목록 조회 -->
    <select id="selectAllCenters" resultMap="SupportCenterResultMap">
        SELECT 
            <include refid="selectColumns"/>
        FROM support_center
        ORDER BY name ASC
    </select>

    <!-- 좌표가 있는 지원센터만 조회 -->
    <select id="selectCentersWithCoordinates" resultMap="SupportCenterResultMap">
        SELECT 
            <include refid="selectColumns"/>
        FROM support_center
        WHERE lat IS NOT NULL 
          AND lng IS NOT NULL
        ORDER BY name ASC
    </select>

    <!-- 특정 관할구역의 지원센터 조회 -->
    <select id="selectCentersByJurisdiction" parameterType="String" resultMap="SupportCenterResultMap">
        SELECT 
            <include refid="selectColumns"/>
        FROM support_center
        WHERE jurisdiction LIKE CONCAT('%', #{jurisdiction}, '%')
        ORDER BY name ASC
    </select>

    <!-- ID로 지원센터 단건 조회 -->
    <select id="selectCenterById" parameterType="Long" resultMap="SupportCenterResultMap">
        SELECT 
            <include refid="selectColumns"/>
        FROM support_center
        WHERE id = #{id}
    </select>

    <!-- 지원센터 좌표 업데이트 -->
    <update id="updateCenterCoordinates" parameterType="com.guideon.funds.domain.SupportCenter">
        UPDATE support_center 
        SET 
            lat = #{lat},
            lng = #{lng},
            updated_at = NOW()
        WHERE id = #{id}
    </update>

</mapper>
